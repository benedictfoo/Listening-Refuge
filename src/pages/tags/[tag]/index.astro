---
import PostGridLayout from "../../../layouts/PostGridLayout.astro";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import {getBlogPosts} from "../../../lib/content";
import {POSTS_PER_PAGE} from "../../../consts";
import PaginationButtons from "../../../components/PaginationButtons.astro";
export async function getStaticPaths() {
    const allPosts = await getBlogPosts();
    const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

    return uniqueTags.map((tag) => {
        const filteredPosts = allPosts.filter((post) =>
            post.data.tags.includes(tag)
        ).sort(
            (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
        );
        return {
            params: {tag},
            props: {posts: filteredPosts},
        };
    });

}
const {posts} = Astro.props;
const {tag} = Astro.params


const firstPagePosts = posts.slice(0, POSTS_PER_PAGE);
const lastPage = Math.ceil(posts.length / POSTS_PER_PAGE)
const currPage = 1
---

<BaseLayout>
    <PostGridLayout posts={firstPagePosts} title={`Posts tagged with: ${tag}`}/>
</BaseLayout>


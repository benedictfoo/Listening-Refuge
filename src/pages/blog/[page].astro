---
import {getCollection, type CollectionEntry} from 'astro:content';
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostGridLayout from "../../layouts/PostGridLayout.astro";
import {getBlogPosts} from "../../lib/content";
import {POSTS_PER_PAGE} from "../../consts";
import PaginationButtons from "../../components/PaginationButtons.astro";

export async function getStaticPaths({paginate}: { paginate: any }) {
    const posts = (await getBlogPosts()).sort(
        (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
    );
    const lastPage = Math.ceil(posts.length / POSTS_PER_PAGE)
    return paginate(posts, {pageSize: POSTS_PER_PAGE, lastPage});
}

const {page}: { page: { data: CollectionEntry<'blog'>[]; currentPage: number; lastPage: number } } = Astro.props;
---
<BaseLayout>
    <PostGridLayout posts={page.data}/>
    <PaginationButtons currPage={page.currentPage} lastPage={page.lastPage}/>
</BaseLayout>